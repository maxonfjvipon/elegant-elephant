architect:
  - maxonfjvipon
docker:
  as_root: true
merge:
  commanders:
    - maxonfjvipon
  script: |-
    echo "Validate composer..."
    composer validate --strict
    echo "Run composer..."
    sudo apt-get install php-xml
    composer install --prefer-dist --no-progress
    echo "Run PHPStan..."
    composer run-script phpstan
    echo "Run PHPUnit..."
    composer run-script tests
release:
  script: |-
    [[ "${tag}" =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]] || exit -1
    echo "Validate composer..."
    composer validate --strict
    echo "Run composer..."
    composer install --prefer-dist --no-progress
    echo "Run PHPStan..."
    composer run-script phpstan
    echo "Run PHPUnit..."
    composer run-script tests
